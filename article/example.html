<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #ffffff; --text-color: #1a1a1a; --accent-color: #000000; }
        @media (prefers-color-scheme: dark) { :root { --bg-color: #000000; --text-color: #e5e5e5; --accent-color: #ffffff; } }

        /* 隱藏默認鼠標 */
        body, html, a, button { cursor: none !important; }

        body {
            background-color: var(--bg-color); color: var(--text-color);
            font-family: 'Noto Serif TC', serif;
            margin: 0; height: 100vh; width: 100vw; overflow: hidden;
            display: flex; flex-direction: column;
            opacity: 0; animation: fadeIn 0.8s ease forwards;
        }

        /* 自定義鼠標 */
        #custom-cursor {
            position: fixed; top: 0; left: 0; width: 12px; height: 12px;
            background-color: var(--text-color); transform: rotate(45deg);
            pointer-events: none; z-index: 99999;
            transition: transform 0.1s, width 0.2s, height 0.2s; mix-blend-mode: difference;
        }
        #custom-cursor.hollow { background: transparent; border: 1.5px solid var(--text-color); transform: rotate(45deg) scale(1.2); }
        #custom-cursor.clicking { transform: rotate(45deg) scale(0.8); background: var(--text-color); }

        .back-arrow {
            position: fixed; top: 30px; left: 30px; opacity: 0.5; z-index: 100; transition: 0.3s;
        }
        .back-arrow:hover { opacity: 1; }
        .back-arrow svg { width: 24px; height: 24px; fill: var(--text-color); }

        /* --- 閱讀容器 --- */
        .reader-viewport {
            flex: 1; /* 佔據除導航外的所有空間 */
            width: 100%; max-width: 800px;
            margin: 0 auto;
            position: relative;
            margin-top: 80px; /* 留出頂部空間 */
            margin-bottom: 80px; /* 留出底部空間 */
        }

        /* 每一頁的容器 */
        .page-slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 0 40px;
            opacity: 0; pointer-events: none; transform: translateX(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            display: flex; flex-direction: column; 
            justify-content: flex-start; /* 內容頂部對齊 */
            gap: 25px; /* 段落間距 */
        }
        
        .page-slide.active { opacity: 1; pointer-events: auto; transform: translateX(0); }

        /* 段落樣式 */
        p {
            font-size: 1.15rem; line-height: 1.9; text-align: justify;
            transition: transform 0.2s ease; /* 微呼吸 */
            transform-origin: left center;
        }
        p:hover { transform: scale(1.01); } /* 極微小的放大 */
        p:active { transform: scale(0.99); } /* 點擊收縮 */

        /* 標題頁特殊樣式 */
        .title-slide { justify-content: center; text-align: center; }
        .title-slide h1 { font-size: 2.2rem; font-weight: 500; margin-bottom: 20px; }
        .title-slide .meta { font-size: 0.9rem; opacity: 0.6; font-family: sans-serif; }

        /* 底部導航 */
        .pagination {
            position: fixed; bottom: 30px; width: 100%;
            display: flex; justify-content: center; align-items: center; gap: 40px;
            font-family: sans-serif; font-size: 0.9rem; user-select: none;
        }
        .nav-btn { opacity: 0.3; padding: 10px; transition: 0.3s; }
        .nav-btn:hover { opacity: 1; }
        .page-indicator { opacity: 0.5; font-size: 0.8rem; letter-spacing: 2px; }

        /* 手機適配 */
        @media (max-width: 768px) {
            body, html, a { cursor: auto !important; }
            #custom-cursor { display: none; }
            .reader-viewport { margin-top: 60px; margin-bottom: 100px; }
            .page-slide { padding: 0 25px; gap: 20px; }
            p { font-size: 1.05rem; }
            .pagination { bottom: 20px; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; } }
    </style>
</head>
<body>
    <div id="custom-cursor"></div>

    <div class="back-arrow interactable" onclick="goBack()">
        <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
    </div>

    <!-- 這裡不直接放內容，而是作為 JS 計算的容器 -->
    <div class="reader-viewport" id="viewport"></div>

    <div class="pagination">
        <div class="nav-btn interactable" onclick="changePage(-1)">PREV</div>
        <div class="page-indicator" id="page-num">1 / 1</div>
        <div class="nav-btn interactable" onclick="changePage(1)">NEXT</div>
    </div>

    <script>
        // === 文章源數據 (在此處填寫，JS 會自動分頁) ===
        // title: 標題對象, paragraphs: 段落數組
        const articleContent = {
            title: "幾何美學的構建",
            date: "2023.11.02",
            paragraphs: [
                "這是第一段內容。在數字的荒原裡，我們試圖用線條和角度構建一座燈塔。點擊任意文本段落即可複製，動畫效果已經調整為非常微小的縮放，保持閱讀的沈浸感。",
                "這是第二段。為了適應不同屏幕，這段 JS 腳本會測量瀏覽器的高度。如果屏幕很高，這一頁可能會顯示三到四個段落；如果是在手機上，可能只能顯示兩段。",
                "設計不應該喧賓奪主，而應該退居幕後。白色背景，黑色文字，沒有多餘的裝飾。每一個像素的間距都是為了呼吸而留。",
                "這是第四段測試長文本。當網絡不好的時候，Moment 頁面的圖片會顯示加載動畫，而在文章頁面，所有的文字都是即時渲染的。",
                "這是新的一頁的內容嗎？取決於你的屏幕大小。我們會逝去，但文字會留下來。翻頁閱讀讓思緒有了停頓的間隙，不再是無止盡的滑動。",
                "最後一段。保持熱愛，奔赴山海。純粹的文字記錄，有時候比圖像更有力量。"
            ]
        };

        let currentPage = 0;
        let totalPages = 0;
        const viewport = document.getElementById('viewport');
        const pageNum = document.getElementById('page-num');

        // --- 核心：動態分頁算法 ---
        function layoutArticle() {
            viewport.innerHTML = ''; // 清空
            currentPage = 0;

            const viewportHeight = viewport.clientHeight;
            let pageDiv = createPageDiv(0); // 創建第一頁
            viewport.appendChild(pageDiv);
            
            // 1. 插入標題 (標題單獨佔一頁，或佔第一頁頂部)
            // 這裡我們讓標題佔第一頁，內容從第二頁開始，或者標題+第一段
            // 為了優雅，我們採用：第一頁是標題頁
            const titleHTML = document.createElement('div');
            titleHTML.className = 'title-slide';
            titleHTML.innerHTML = `<h1>${articleContent.title}</h1><div class="meta">${articleContent.date}</div>`;
            pageDiv.appendChild(titleHTML);
            
            // 創建第二頁用於放正文
            let currentContentPage = createPageDiv(1); // 實際上是 index 1
            viewport.appendChild(currentContentPage);
            let activePage = currentContentPage;
            let pageIndex = 1;

            // 臨時元素用於測量高度
            const tempDiv = document.createElement('div');
            tempDiv.style.visibility = 'hidden';
            tempDiv.style.position = 'absolute';
            tempDiv.style.width = viewport.clientWidth - 80 + 'px'; // 減去 padding
            document.body.appendChild(tempDiv);

            // 2. 循環處理段落
            articleContent.paragraphs.forEach(text => {
                // 創建 P 標籤
                const p = document.createElement('p');
                p.className = 'interactable-text';
                p.innerText = text;
                p.onclick = () => copyText(p);

                // 測量這個 P 的高度
                tempDiv.innerHTML = '';
                const cloneP = p.cloneNode(true);
                tempDiv.appendChild(cloneP);
                const pHeight = tempDiv.clientHeight + 25; // 25是 gap

                // 獲取當前頁面已用高度
                // 注意：這裡簡單估算，遍歷 children 累加
                let currentUsedHeight = 0;
                Array.from(activePage.children).forEach(child => {
                    currentUsedHeight += child.clientHeight + 25;
                });

                // 判斷是否溢出
                if (currentUsedHeight + pHeight > viewportHeight) {
                    // 溢出，創建新頁
                    pageIndex++;
                    activePage = createPageDiv(pageIndex);
                    viewport.appendChild(activePage);
                    activePage.appendChild(p);
                } else {
                    // 沒溢出，加入當前頁
                    activePage.appendChild(p);
                }
            });

            document.body.removeChild(tempDiv); // 清理測量工具
            
            totalPages = pageIndex + 1;
            
            // 顯示第一頁
            document.querySelectorAll('.page-slide')[0].classList.add('active');
            updateIndicator();
            bindCursorEvents();
        }

        function createPageDiv(index) {
            const div = document.createElement('div');
            div.className = 'page-slide';
            div.dataset.index = index;
            if (index === 0) div.classList.add('title-slide'); // 標記標題頁樣式
            return div;
        }

        // --- 交互邏輯 ---
        function changePage(dir) {
            const next = currentPage + dir;
            if (next >= 0 && next < totalPages) {
                const pages = document.querySelectorAll('.page-slide');
                pages[currentPage].classList.remove('active');
                currentPage = next;
                pages[currentPage].classList.add('active');
                updateIndicator();
            }
        }

        function updateIndicator() {
            pageNum.innerText = `${currentPage + 1} / ${totalPages}`;
        }

        async function copyText(el) {
            try {
                await navigator.clipboard.writeText(el.innerText);
                // 這裡無需提示，僅依靠 CSS 的 active 縮放效果
            } catch(e) {}
        }

        // --- 初始化與監聽 ---
        window.addEventListener('resize', () => {
            // 簡單防抖：窗口大小改變時重新排版
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(layoutArticle, 200);
        });

        // 鼠標
        const cursor = document.getElementById('custom-cursor');
        document.addEventListener('mousemove', e => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });
        document.addEventListener('mousedown', () => cursor.classList.add('clicking'));
        document.addEventListener('mouseup', () => cursor.classList.remove('clicking'));

        function bindCursorEvents() {
            document.querySelectorAll('.interactable, .interactable-text').forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('hollow'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('hollow'));
            });
        }

        function goBack() {
            document.body.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => { window.location.href = '../../articles.html'; }, 500);
        }

        // 啟動排版
        layoutArticle();

    </script>
</body>
</html>
